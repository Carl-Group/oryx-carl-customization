#!/usr/bin/env bash

echo "Foreach run script"

# Disable the swap, after migrate platform to docker.
if [[ -f /srs-swapfile ]]; then
  swapoff /srs-swapfile && rm -rf /srs-swapfile
  if [[ $? -ne 0 ]]; then echo "Disable swap failed"; exit 1; fi
fi

# Revert the redis config, after migrate to docker.
if [[ -f /etc/redis.conf || -f /etc/redis/redis.conf ]]; then
  bash auto/setup_redis
  if [[ $? -ne 0 ]]; then echo "Setup redis failed"; exit 1; fi
fi

# We setup the docker network.
bash auto/setup_network
if [[ $? -ne 0 ]]; then echo "Setup docker network failed"; exit 1; fi

